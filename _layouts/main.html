<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Deployer &mdash; {{page.title}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="lib/prism.css">
</head>
<body>
<header>
    <div class="container">
        <h1>Deployer</h1>

        <h2>Deployment Tool for PHP</h2>

        <div class="toolbar">
            <i class="x"></i>
            <i class="minus"></i>
            <i class="plus"></i>
            <img src="images/home.png" alt="">TryDeployer &mdash; 1300x310
        </div>
        <div class="code">
            <div class="console">Press enter to submit commands.
</div>
            <form>
                <label for="input">&gt;</label>

                <div class="input">
                    <input type="text" value="" id="input">
                </div>
            </form>
        </div>
    </div>
</header>
<section>
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <ul id="nav" class="nav nav-pills nav-stacked">
                    <li><a href="#introduction">Introduction</a></li>
                    <li><a href="#get-started">Get started</a></li>
                    <li><a href="#installation">Installation</a></li>
                </ul>
            </div>

            <div class="col-md-10">
                {{ content }}
            </div>
        </div>
    </div>
</section>

<script src="lib/jquery.min.js"></script>
<script src="lib/autocomplete.js"></script>
<script src="lib/prism.js"></script>

<script>
    $(function () {
        var code = $('.code');
        var console = $('.console');
        var input = $('input').focus();
        var form = $('form');
        var scroll = function () {
            code.scrollTop(code[0].scrollHeight);
        };

        var notFound;
        var delay = function (answer) {
            console.append(answer.shift());
            scroll();
            setTimeout(function () {
                delay(answer);
            }, 1000);
        };
        var to = function (command, need, answer) {
            if (need.indexOf(command) != -1) {

                if (Object.prototype.toString.call(answer) === '[object Array]') {
                    delay(answer);
                } else {
                    console.append(answer);
                }
                notFound = false;
            }
        };

        input.autocomplete({
            '^\\w*$': ['ls', 'pwd', 'dep', 'help'],
            '^dep \\w*$': ['deploy', 'rollback', 'migrate', 'help', 'list']
        });

        form.submit(function (event) {
            event.stopPropagation();

            var command = $.trim(input.val());
            if (command == '') {
                return false;
            }

            console.append('&gt; ' + command + '\n');

            notFound = true;

            to(command, ['help', '?', '/?'], 'This is an example of the console to try Deployer in your browser.\n' +
                    'Try type the following commands and press enter:\n' +
                    'dep\n' +
                    'dep deploy\n' +
                    'dep rollback' +
                    'ls\n');

            to(command, ['dep', 'dep help', 'dep list'], 'Deployer\n' +
                    '\n' +
                    'Usage:\n' +
                    '  dep [command] [options]\n' +
                    '\n' +
                    'Available commands:\n' +
                    '  help          Displays help for a command\n' +
                    '  list          Lists commands\n' +
                    '  deploy        Deploy project\n');

            to(command, ['ls'], 'bin\n' +
                    'src\n' +
                    'vendor\n' +
                    '.gitignore\n' +
                    'deploy.php\n');

            to(command, ['pwd'], '/home/www\n');

            to(command, ['dep deploy'], [
                '--> Updating code base with checkout strategy...............✔\n',
                '--> Creating cache directory................................✔\n',
                '--> Creating symlinks for shared directories................✔\n',
                '--> Creating symlinks for shared files......................✔\n',
                '--> Normalizing asset timestamps............................✔\n',
                '--> Downloading Composer....................................✔\n',
                '--> Installing Composer dependencies........................✔\n',
                '--> Dumping all assets to the filesystem....................✔\n',
                '--> Warming up cache........................................✔\n',
                '--> Clear controllers.......................................✔\n',
                '--> Setting permissions.....................................✔\n',
                '--> <i>Successfully deployed!</i>\n']);

            if (notFound) {
                console.append('Sorry but this command can not be run in the emulator.\n');
            }

            scroll();
            input.val('');

            return false;
        });

        $(document).keydown(function () {
            input.focus();
        });
    });
</script>

<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42432799-1']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();

</script>
</body>
</html>
